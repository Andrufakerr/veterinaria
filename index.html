<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Turnos Veterinaria</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    
  /* Contenedor del logo y hora */
  #header {
    width: 100%;
    background: linear-gradient(to right, #3b0160, #950497);
    color: #fff;
    text-align: center;
    padding: 20px 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    font-family: Arial, sans-serif;
  }

  #header img {
    width: 400px;
    max-width: 50%;
    display: block;
    margin: 0 auto 10px auto;
  }

  #horaFecha {
    font-size: 18px;
    font-weight: bold;
  }

  /* M√≥vil */
  @media(max-width:768px){
    #header img {
      width: 140px;
    }
    #horaFecha {
      font-size:16px;
    }
  }

  </style>
</head>
<body>
  <!-- üü£ Sidebar -->

<a href="#" id="btnNuevoTurno" class="turno">‚ûï Nuevo Turno</a>
  <!-- üü¢ Contenido -->
  <main class="content">
    <div class="topbar">
    </div>
<div id="header">
  <img src="imagenes/logo.png" alt="Logo" id="logoGym">
</div>
    <section class="page">
      <table class="tabla-turnos">
        <thead>
          <tr>
            <th>Due√±o</th>
            <th>Perro</th>
            <th>Tel√©fono</th>
            <th>Servicio</th>
            <th>Hora</th>
            <th>Fecha</th>
            <th>Notas</th>
          </tr>
        </thead>
        <tbody id="lista"></tbody>
      </table>
    </section>
  </main>

  <!-- üîµ MODAL NUEVO TURNO -->
  <div id="modalTurno" class="modal">
    <div class="editorcaja">
      <h3>Nuevo Turno</h3>
      <form id="formTurno" class="scroll-form">
        <label>Nombre del Due√±o:</label>
        <input type="text" id="due√±o" required>

        <label>Nombre del Perro:</label>
        <input type="text" id="perro" required>

        <label>Tel√©fono:</label>
        <input type="text" id="telefono" required>

        <label>Servicio:</label>
        <select id="servicio" required>
          <option value="">Seleccionar...</option>
          <option value="Deslanados">Deslanados</option>
          <option value="Ba√±os sanitarios">Ba√±os sanitarios</option>
          <option value="Corte de u√±as">Corte de u√±as</option>
          <option value="Peluquer√≠a general">Peluquer√≠a general</option>
        </select>

        <label>Fecha del Turno:</label>
        <input type="date" id="fecha" required>

        <label>Horario:</label>
        <select id="hora" required>
          <option value="">Seleccionar...</option>
          <option value="15:00">15:00</option>
          <option value="16:30">16:30</option>
          <option value="18:30">18:30</option>
        </select>

        <label>Notas:</label>
        <textarea id="notas" rows="3"></textarea>

        <div style="margin-top:15px; display:flex; justify-content:space-between;">
          <button type="submit" class="btn-primary">Guardar</button>
          <button type="button" id="btnCancelar" class="btn">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- üü® Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, query, orderByChild } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js";

    // Configuraci√≥n Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBu8D-puwW2E5pkKsXOKYjsQr_UnqhGrqw",
      authDomain: "veterinaria-28331.firebaseapp.com",
      projectId: "veterinaria-28331",
      storageBucket: "veterinaria-28331.firebasestorage.app",
      messagingSenderId: "709696984659",
      appId: "1:709696984659:web:08e9f2008b4195f0eb58a6",
      databaseURL: "https://veterinaria-28331-default-rtdb.firebaseio.com"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Referencias
    const modal = document.getElementById("modalTurno");
    const btnNuevoTurno = document.getElementById("btnNuevoTurno");
    const btnCancelar = document.getElementById("btnCancelar");
    const form = document.getElementById("formTurno");
    const lista = document.getElementById("lista");

    // Abrir y cerrar modal
    btnNuevoTurno.onclick = () => modal.classList.add("active");
    btnCancelar.onclick = () => modal.classList.remove("active");
    window.onclick = e => { if (e.target === modal) modal.classList.remove("active"); };

    // Guardar turno
    form.addEventListener("submit", e => {
      e.preventDefault();

      const turno = {
        due√±o: document.getElementById("due√±o").value.trim(),
        perro: document.getElementById("perro").value.trim(),
        telefono: document.getElementById("telefono").value.trim(),
        servicio: document.getElementById("servicio").value,
        fecha: document.getElementById("fecha").value,
        hora: document.getElementById("hora").value,
        notas: document.getElementById("notas").value.trim()
      };

      // Validaci√≥n r√°pida
      if (!turno.due√±o || !turno.perro || !turno.fecha || !turno.hora) {
        alert("Por favor completa todos los campos obligatorios.");
        return;
      }

      // Evitar duplicados (misma fecha y hora)
      const refTurnos = ref(db, "turnos");
      let duplicado = false;

      onValue(refTurnos, snapshot => {
        snapshot.forEach(child => {
          const t = child.val();
          if (t.fecha === turno.fecha && t.hora === turno.hora) duplicado = true;
        });
      }, { onlyOnce: true });

      setTimeout(() => {
        if (duplicado) {
          alert("‚ö†Ô∏è Ese horario ya est√° ocupado.");
        } else {
          push(ref(db, "turnos"), turno);
          alert("‚úÖ Turno guardado correctamente.");
          form.reset();
          modal.classList.remove("active");
        }
      }, 500);
    });

    // Mostrar todos los turnos ordenados por fecha y hora
    // üîπ Traer todos los turnos
onValue(ref(db, "turnos"), snapshot => {
  lista.innerHTML = "";
  const data = [];

  snapshot.forEach(child => {
    const t = child.val();
    data.push(t);
  });

  // Ordenar por fecha + hora en JS
  data.sort((a, b) => {
    const fechaHoraA = a.fecha + a.hora;
    const fechaHoraB = b.fecha + b.hora;
    return fechaHoraA.localeCompare(fechaHoraB);
  });

  // Imprimir en tabla
  data.forEach(t => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${t.due√±o}</td>
      <td>${t.perro}</td>
      <td>${t.telefono}</td>
      <td>${t.servicio}</td>
      <td>${t.hora}</td>
      <td>${t.fecha}</td>
      <td>${t.notas || ""}</td>
    `;
    lista.appendChild(tr);
  });
});

  </script>
  
</body>
</html>
